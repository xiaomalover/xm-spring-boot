(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3bd96fe4"],{1260:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Card",[i("Form",{ref:"articleForm",attrs:{model:t.articleForm,"label-width":70,rules:t.articleFormValidate}},[i("FormItem",{attrs:{label:"文章标题",prop:"title"}},[i("Input",{attrs:{autocomplete:"off",placeholder:"请输入文章标题"},model:{value:t.articleForm.title,callback:function(e){t.$set(t.articleForm,"title",e)},expression:"articleForm.title"}})],1),i("FormItem",{attrs:{label:"缩略图"}},[t._l(t.uploadList,(function(e){return i("div",{key:e.url,staticClass:"upload-list"},["finished"===e.status?[e.url?i("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.url}}):t._e(),i("div",{class:{optEnable:t.operateEnable,optDisable:t.operateDisable}},[i("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(i){return t.handleView(e.url)}}}),i("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(i){return t.handleRemove(e)}}})],1)]:[e.showProgress?i("Progress",{attrs:{percent:e.percentage,"hide-info":""}}):t._e()]],2)})),i("Upload",{ref:"upload",class:{uploadBtnDisabled:t.uploadDisabled,uploadBtnEnable:t.uploadEnable},attrs:{"show-upload-list":!1,"default-file-list":t.defaultList,"on-success":t.handleSuccess,"on-error":t.handleError,format:["jpg","jpeg","png","gif"],"max-size":5120,multiple:!1,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize,type:"drag",action:t.uploadFileUrl,headers:t.accessToken}},[i("div",{staticStyle:{width:"58px",height:"58px","line-height":"58px"}},[i("Icon",{attrs:{type:"md-add",size:"20"}})],1)])],2),i("FormItem",{attrs:{label:"文章简介",prop:"summary"}},[i("Input",{attrs:{type:"textarea",placeholder:"请输入公告简介..."},model:{value:t.articleForm.summary,callback:function(e){t.$set(t.articleForm,"summary",e)},expression:"articleForm.summary"}})],1),i("FormItem",{attrs:{label:"文章内容",prop:"content"}},[i("editor",{attrs:{"api-key":t.apiKey,init:t.editConfig},model:{value:t.articleForm.content,callback:function(e){t.$set(t.articleForm,"content",e)},expression:"articleForm.content"}})],1),i("FormItem",{attrs:{label:"作者",prop:"author"}},[i("Input",{attrs:{autocomplete:"off",placeholder:"请输入作者信息"},model:{value:t.articleForm.author,callback:function(e){t.$set(t.articleForm,"author",e)},expression:"articleForm.author"}})],1),i("Form-item",{attrs:{label:"所属分类",prop:"categoryTitle"}},[i("Poptip",{attrs:{trigger:"click",placement:"bottom-start",title:"选择分类"}},[i("div",{staticStyle:{display:"flex"}},[i("Input",{staticStyle:{"margin-right":"10px"},attrs:{readonly:""},model:{value:t.articleForm.categoryTitle,callback:function(e){t.$set(t.articleForm,"categoryTitle",e)},expression:"articleForm.categoryTitle"}}),i("Button",{attrs:{icon:"md-trash"},on:{click:t.clearSelectDep}},[t._v("清空已选")])],1),i("div",{attrs:{slot:"content"},slot:"content"},[i("Tree",{attrs:{data:t.dataDep,"load-data":t.loadDataTree},on:{"on-select-change":t.selectTree}}),t.loading?i("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)])],1),i("FormItem",{attrs:{label:"是否展示",prop:"status"}},[i("Select",{attrs:{placeholder:"请选择是否要展示"},model:{value:t.articleForm.status,callback:function(e){t.$set(t.articleForm,"status",e)},expression:"articleForm.status"}},[i("Option",{attrs:{value:0}},[t._v("否")]),i("Option",{attrs:{value:1}},[t._v("是")])],1)],1),i("FormItem",[i("Button",{attrs:{type:"default"},on:{click:t.cancelArticle}},[t._v("返回列表")]),i("Button",{staticStyle:{float:"right"},attrs:{type:"primary",loading:t.submitLoading},on:{click:t.submitArticle}},[t._v("提交")])],1)],1)],1),i("Modal",{attrs:{title:"图片预览",draggable:""},model:{value:t.viewImage,callback:function(e){t.viewImage=e},expression:"viewImage"}},[i("img",{staticStyle:{width:"80%",margin:"0 auto",display:"block"},attrs:{src:t.imgUrl}}),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:function(e){t.viewImage=!1}}},[t._v("关闭")])],1)])],1)},o=[],r=(i("a450"),i("4057"),i("1bc7"),["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"]),a=function(t){return-1!==r.map((function(t){return t.toLowerCase()})).indexOf(t.toLowerCase())},l=function(t,e,i){Object.keys(e).filter(a).forEach((function(n){var o=e[n];"function"===typeof o&&("onInit"===n?o(t,i):i.on(n.substring(2),(function(t){return o(t,i)})))}))},s=function(t,e){var i=t.$props.modelEvents?t.$props.modelEvents:null,n=Array.isArray(i)?i.join(" "):i;e.on(n||"change input undo redo",(function(){t.$emit("input",e.getContent({format:t.$props.outputFormat}))}))},c=function(t,e,i){var n=e.$props.value?e.$props.value:"",o=e.$props.initialValue?e.$props.initialValue:"";i.setContent(n||(e.initialized?e.cache:o)),e.$watch("value",(function(t,n){i&&"string"===typeof t&&t!==n&&t!==i.getContent({format:e.$props.outputFormat})&&i.setContent(t)})),e.$listeners.input&&s(e,i),l(t,e.$listeners,i),e.initialized=!0},u=0,d=function(t){var e=Date.now(),i=Math.floor(1e9*Math.random());return u++,t+"_"+i+u+String(e)},p=function(t){return null!==t&&"textarea"===t.tagName.toLowerCase()},h=function(t){return"undefined"===typeof t||""===t?[]:Array.isArray(t)?t:t.split(" ")},m=function(t,e){return h(t).concat(h(e))},f=function(t){return null===t||void 0===t},g=function(){return{listeners:[],scriptId:d("tiny-script"),scriptLoaded:!1}},b=function(){var t=g(),e=function(t,e,i,n){var o=e.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.id=t,o.src=i;var r=function(){o.removeEventListener("load",r),n()};o.addEventListener("load",r),e.head&&e.head.appendChild(o)},i=function(i,n,o){t.scriptLoaded?o():(t.listeners.push(o),i.getElementById(t.scriptId)||e(t.scriptId,i,n,(function(){t.listeners.forEach((function(t){return t()})),t.scriptLoaded=!0})))},n=function(){t=g()};return{load:i,reinitialize:n}},y=b(),v=i("521b"),F={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],value:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(t){return"html"===t||"text"===t}}},$=function(){return $=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i],e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},$.apply(this,arguments)},w=function(t,e,i){return t(i||"div",{attrs:{id:e}})},S=function(t,e){return t("textarea",{attrs:{id:e},style:{visibility:"hidden"}})},D=function(t){return function(){var e=$($({},t.$props.init),{readonly:t.$props.disabled,selector:"#"+t.elementId,plugins:m(t.$props.init&&t.$props.init.plugins,t.$props.plugins),toolbar:t.$props.toolbar||t.$props.init&&t.$props.init.toolbar,inline:t.inlineEditor,setup:function(e){t.editor=e,e.on("init",(function(i){return c(i,t,e)})),t.$props.init&&"function"===typeof t.$props.init.setup&&t.$props.init.setup(e)}});p(t.element)&&(t.element.style.visibility="",t.element.style.display=""),Object(v["a"])().init(e)}},I={props:F,created:function(){this.elementId=this.$props.id||d("tiny-vue"),this.inlineEditor=this.$props.init&&this.$props.init.inline||this.$props.inline,this.initialized=!1},watch:{disabled:function(){this.editor.setMode(this.disabled?"readonly":"design")}},mounted:function(){if(this.element=this.$el,null!==Object(v["a"])())D(this)();else if(this.element&&this.element.ownerDocument){var t=this.$props.cloudChannel?this.$props.cloudChannel:"5",e=this.$props.apiKey?this.$props.apiKey:"no-api-key",i=f(this.$props.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+e+"/tinymce/"+t+"/tinymce.min.js":this.$props.tinymceScriptSrc;y.load(this.element.ownerDocument,i,D(this))}},beforeDestroy:function(){null!==Object(v["a"])()&&Object(v["a"])().remove(this.editor)},deactivated:function(){var t;this.inlineEditor||(this.cache=this.editor.getContent(),null===(t=Object(v["a"])())||void 0===t||t.remove(this.editor))},activated:function(){!this.inlineEditor&&this.initialized&&D(this)()},render:function(t){return this.inlineEditor?w(t,this.elementId,this.$props.tagName):S(t,this.elementId)}},k=I,x=i("23d5"),C=i.n(x),L=i("365c"),O={name:"edit-manage",components:{Editor:k},data:function(){return{accessToken:{},loading:!0,editor:"",drop:!1,fullscreen:!1,dropDownContent:"展开",dropDownIcon:"ios-arrow-down",selectCount:0,actionType:"",articleId:"",defaultList:[{url:""}],apiKey:"",editConfig:{height:500,language_url:"/tinymce/langs/zh_CN.js",language:"zh_CN",browser_spellcheck:!0,branding:!1,elementpath:!0,statusbar:!0,paste_data_images:!0,menubar:!0,fontsize_formats:"14px 16px 18px 20px 24px 26px 28px 30px 32px 36px",font_formats:"微软雅黑=Microsoft YaHei,Helvetica Neue;PingFang SC;sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;宋体=simsun;serifsans-serif;Terminal=terminal;monaco;Times New Roman=times new roman;times",file_picker_types:"image",images_upload_credentials:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"fontselect fontsizeselect link lineheight forecolor backcolor bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | image quicklink h2 h3 blockquote table numlist bullist preview fullscreen",images_upload_handler:function(t,e,i){var n=new FormData;n.append("file",t.blob()),n.append("folder","editor/"+C()().format("YYYYMMDD")),Object(L["gb"])(n).then((function(t){e(t.result.url)})).catch((function(){i("error")}))}},imgUrl:"",uploadList:[],viewImage:!1,uploadFileUrl:L["fb"],selectList:[],selectDep:[],dataDep:[],selectDate:null,modalType:0,modalTitle:"",articleForm:{title:"",content:"",author:"XM 团队",summary:"",categoryTitle:"",status:null,thumb:""},articleFormValidate:{title:[{required:!0,message:"标题不能为空"}],status:[{required:!0,message:"请选择是否展示"}],content:[{required:!0,message:"内容不能为空",trigger:"blur"}]},submitLoading:!1,data:[],exportData:[],total:0}},methods:{init:function(){this.accessToken={accessToken:this.getStore("accessToken")},this.uploadList=this.$refs.upload.fileList,this.getParentList(),this.actionType=this.$route.query.type,"edit"===this.actionType&&(this.articleId=this.$route.query.id,this.getArticleDetail())},getArticleDetail:function(){var t=this;this.loading=!0,Object(L["K"])(this.articleId).then((function(e){if(t.loading=!1,!0===e.success){t.$refs.articleForm.resetFields();var i=JSON.stringify(e.result),n=JSON.parse(i);t.articleForm=n,t.defaultList[0].url=""!==t.articleForm.thumb?t.articleForm.thumb:"",t.uploadList=""!==t.articleForm.thumb?t.defaultList:[]}}))},cancelArticle:function(){this.$router.push({path:"/article/module/article/info"})},submitArticle:function(){var t=this;this.$refs.articleForm.validate((function(e){e&&("add"===t.actionType?(delete t.articleForm.id,t.submitLoading=!0,Object(L["a"])(t.articleForm).then((function(e){t.submitLoading=!1,!0===e.success&&(t.$Message.success("添加成功"),t.$router.push({path:"/article/module/article/info"}))}))):Object(L["w"])(t.articleForm).then((function(e){t.submitLoading=!1,!0===e.success&&(t.$Message.success("修改成功"),t.$router.push({path:"/article/module/article/info"}))})))}))},getParentList:function(){var t=this;Object(L["W"])(0).then((function(e){!0===e.success&&(t.loading=!1,e.result.forEach((function(t){t.isParent&&(t.loading=!1,t.children=[])})),t.deleteDisableNode(e.result),t.dataDep=e.result)}))},deleteDisableNode:function(t){var e=this;t.forEach((function(t){0===t.status&&(t.title="[已禁用] "+t.title,t.disabled=!0),t.children&&t.children.length>0&&e.deleteDisableNode(t.children)}))},loadData:function(t,e){t.loading=!0,Object(L["W"])(t.value).then((function(i){t.loading=!1,!0===i.success&&(i.result.forEach((function(t){t.isParent?(t.value=t.id,t.label=t.title,t.loading=!1,t.children=[]):(t.value=t.id,t.label=t.title)})),deleteDisableNode(i.result),t.children=i.result,e())}))},loadDataTree:function(t,e){var i=this;t.loading=!0,Object(L["W"])(t.id).then((function(t){!0===t.success&&(t.result.forEach((function(t){t.isParent&&(t.loading=!1,t.children=[])})),i.deleteDisableNode(t.result),e(t.result))}))},selectTree:function(t){if(t.length>0){for(var e in t[0])null===t[0][e]&&(t[0][e]="");var i=JSON.stringify(t[0]),n=JSON.parse(i);this.articleForm.categoryId=n.id,this.articleForm.categoryTitle=n.title}},clearSelectDep:function(){this.articleForm.categoryId="",this.articleForm.categoryTitle=""},handleChangeDep:function(t,e){t&&t.length>0?this.searchForm.categoryId=t[t.length-1]:this.searchForm.categoryId=""},handleChangeUserFormDep:function(t,e){t&&t.length>0?this.articleForm.categoryId=t[t.length-1]:this.articleForm.categoryId=""},handleView:function(t){this.imgUrl=t,this.viewImage=!0},handleRemove:function(t){var e=this.$refs.upload.fileList;this.articleForm.thumb="",this.$refs.upload.fileList.splice(e.indexOf(t),1),this.defaultList[0].url="",this.uploadList=[]},handleSuccess:function(t,e){!0===t.success?(e.url=t.result.url,this.articleForm.thumb=t.result.url,this.defaultList[0].url=t.result.url,this.uploadList=this.defaultList):this.$Message.error(t.message)},handleError:function(t,e,i){this.$Message.error(t.toString())},handleFormatError:function(t){this.$Notice.warning({title:"不支持的文件格式",desc:"所选文件‘ "+t.name+" ’格式不正确, 请选择 .jpg .jpeg .png .gif格式文件"})},handleMaxSize:function(t){this.$Notice.warning({title:"文件大小过大",desc:"所选文件‘ "+t.name+" ’大小过大, 不得超过 5M."})}},computed:{uploadDisabled:function(){return""!==this.defaultList[0].url},uploadEnable:function(){return""===this.defaultList[0].url},operateEnable:function(){return""!==this.defaultList[0].url},operateDisable:function(){return""===this.defaultList[0].url}},mounted:function(){this.init()}},E=O,j=(i("57c0"),i("cba8")),_=Object(j["a"])(E,n,o,!1,null,null,null);e["default"]=_.exports},"521b":function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return o}));var n=function(){return"undefined"!==typeof window?window:t},o=function(){var t=n();return t&&t.tinymce?t.tinymce:null}}).call(this,i("2409"))},"57c0":function(t,e,i){"use strict";i("ad0a")},ad0a:function(t,e,i){}}]);